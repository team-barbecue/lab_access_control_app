# 研究室管理システム 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
研究室管理システム - Lab Access Control App

### 1.2 目的
研究室の入退室管理を効率化し、研究室内の人員状況をリアルタイムで把握できるシステムを構築する。

### 1.3 背景
- 従来の手動による入退室記録の非効率性
- 研究室内の人員状況の可視化の必要性
- 入退室履歴の管理・分析の需要

### 1.4 対象ユーザー
- 研究室の学生・教員
- 研究室管理者
- システム管理者

## 2. システム概要

### 2.1 システム構成
- **フロントエンド**: React.js + Vite
- **バックエンド**: Node.js + Express.js
- **データストレージ**: JSONファイル（ファイルベース）
- **通信**: HTTP REST API

### 2.2 システムアーキテクチャ
```
┌─────────────┐    HTTP    ┌─────────────┐    File I/O   ┌─────────────┐
│  ブラウザ   │ ←──────→  │ Express.js  │ ←──────────→ │ JSON Files  │
│ (React.js)  │            │  Server     │              │ (Data)      │
└─────────────┘            └─────────────┘              └─────────────┘
```

## 3. 機能要件

### 3.1 基本機能

#### 3.1.1 入退室管理機能
**機能ID**: F001
**優先度**: 高
**説明**: ユーザーの入室・退室を記録・管理する

**詳細仕様**:
- ユーザーIDによる識別
- 入室・退室時刻の記録
- コメント・理由の記録（任意）
- リアルタイムな状態更新

**入力**:
- ユーザーID（必須）
- コメント（任意）

**出力**:
- 入退室記録の成功/失敗
- 更新された座席状況

#### 3.1.2 座席表示機能
**機能ID**: F002
**優先度**: 高
**説明**: 研究室内の座席状況を視覚的に表示する

**詳細仕様**:
- 座席の配置表示
- 各座席の占有状況表示
- 座席クリックによる入退室操作
- ユーザー名の表示

**表示項目**:
- 座席番号
- ユーザー名
- 在室状況（在室/不在）
- 最終更新時刻

#### 3.1.3 ログ表示機能
**機能ID**: F003
**優先度**: 中
**説明**: 入退室履歴を表示・管理する

**詳細仕様**:
- 最新20件のログ表示
- ユーザーID、ユーザー名、アクション、時刻、コメントの表示
- 時系列順での表示（最新順）

**表示項目**:
- ユーザーID
- ユーザー名
- アクション（入室/退室）
- タイムスタンプ
- コメント

#### 3.1.4 ナビゲーション機能
**機能ID**: F004
**優先度**: 中
**説明**: システム内の各ページ間を移動する

**詳細仕様**:
- 部屋ページ（メイン）
- 入室ページ
- 退室ページ
- アクティブページの表示

### 3.2 拡張機能

#### 3.2.1 クッキー機能
**機能ID**: F005
**優先度**: 低
**説明**: ユーザーIDとコメントをブラウザに保存・復元する

**詳細仕様**:
- ユーザーIDの自動保存（30日間）
- コメントの自動保存（30日間）
- ページ読み込み時の自動復元
- リアルタイム保存

**保存データ**:
- `lab_user_id`: ユーザーID
- `lab_comment`: コメント

#### 3.2.2 ユーザー名自動取得機能
**機能ID**: F006
**優先度**: 低
**説明**: ユーザーID入力時に自動でユーザー名を取得・表示する

**詳細仕様**:
- ユーザーID入力時のリアルタイム検索
- 既存ユーザーの場合の名前表示
- 新規ユーザーの場合の空表示

## 4. 非機能要件

### 4.1 性能要件

#### 4.1.1 レスポンス時間
- ページ表示: 3秒以内
- API応答: 1秒以内
- 入退室記録: 2秒以内

#### 4.1.2 同時アクセス数
- 最大同時ユーザー数: 50人
- 最大同時API呼び出し: 100回/分

#### 4.1.3 データ容量
- ユーザーデータ: 最大1000件
- ログデータ: 最大10000件

### 4.2 可用性要件

#### 4.2.1 稼働時間
- 目標稼働率: 99.5%
- 計画メンテナンス時間: 月1回、2時間以内

#### 4.2.2 障害復旧
- 障害検知時間: 5分以内
- 復旧時間: 30分以内

### 4.3 セキュリティ要件

#### 4.3.1 認証・認可
- ユーザーIDによる基本的な識別
- 入退室記録の権限管理（全ユーザーが利用可能）

#### 4.3.2 データ保護
- 個人情報の適切な管理
- ログデータの保持期間管理

### 4.4 保守性要件

#### 4.4.1 コード品質
- 可読性の高いコード
- 適切なコメント・ドキュメント
- モジュール化された設計

#### 4.4.2 拡張性
- 新機能追加の容易性
- 設定変更の柔軟性

## 5. 画面要件

### 5.1 部屋ページ（メインページ）

#### 5.1.1 レイアウト
- ヘッダー: システム名、現在の在室者数、ナビゲーション
- メインエリア: 座席レイアウト
- サイドバー: 入退室ログ

#### 5.1.2 表示要素
- 座席グリッド（5x4の20席）
- 各座席の状態表示
- 在室者数/最大定員の表示
- 最新ログの表示

### 5.2 入室ページ

#### 5.2.1 レイアウト
- ヘッダー: システム名、ナビゲーション
- メインエリア: 入室記録フォーム

#### 5.2.2 フォーム要素
- ユーザーID入力フィールド
- コメント入力フィールド
- 送信ボタン
- メッセージ表示エリア

### 5.3 退室ページ

#### 5.3.1 レイアウト
- ヘッダー: システム名、ナビゲーション
- メインエリア: 退室記録フォーム

#### 5.3.2 フォーム要素
- ユーザーID入力フィールド
- コメント入力フィールド
- 送信ボタン
- メッセージ表示エリア

## 6. API仕様

### 6.1 ユーザー管理API

#### 6.1.1 ユーザー一覧取得
```
GET /api/users
Response: User[]
```

#### 6.1.2 入室記録
```
POST /api/users/:userID/enter
Body: { userID: string, comment?: string }
Response: { success: boolean, user: User, error?: string }
```

#### 6.1.3 退室記録
```
POST /api/users/:userID/exit
Body: { userID: string, comment?: string }
Response: { success: boolean, user: User, error?: string }
```

### 6.2 ログ管理API

#### 6.2.1 ログ一覧取得
```
GET /api/logs
Response: Log[]
```

## 7. データモデル

### 7.1 ユーザーデータ
```typescript
interface User {
  userID: string;        // ユーザーID（一意）
  userName: string;      // ユーザー名
  isInRoom: boolean;     // 在室状況
  lastUpdate: string;    // 最終更新時刻（ISO形式）
}
```

### 7.2 ログデータ
```typescript
interface Log {
  userID: string;        // ユーザーID
  userName: string;      // ユーザー名
  action: 'enter' | 'exit'; // アクション
  timestamp: string;     // タイムスタンプ（ISO形式）
  comment: string | null; // コメント
}
```

## 8. 制約事項

### 8.1 技術的制約
- ブラウザ対応: Chrome, Firefox, Safari, Edge（最新版）
- Node.jsバージョン: v16以上
- データベース: JSONファイルベース（軽量性重視）

### 8.2 運用制約
- データバックアップ: 手動（自動化は今後の課題）
- ログローテーション: 手動（自動化は今後の課題）
- 監視・アラート: 未実装（今後の課題）

## 9. 今後の拡張予定

### 9.1 短期（3ヶ月以内）
- データベース化（SQLite/PostgreSQL）
- ユーザー認証機能
- 管理者画面

### 9.2 中期（6ヶ月以内）
- 統計・レポート機能
- 通知機能（Slack連携など）
- モバイル対応

### 9.3 長期（1年以内）
- 複数研究室対応
- 予約システム
- 分析・予測機能

## 10. 受入基準

### 10.1 機能テスト
- 全ての基本機能が正常に動作すること
- エラーハンドリングが適切に動作すること
- クッキー機能が正常に動作すること

### 10.2 性能テスト
- レスポンス時間が要件を満たすこと
- 同時アクセス時の安定性が確保されること

### 10.3 セキュリティテスト
- 基本的なセキュリティ要件を満たすこと
- データの整合性が保たれること

## 11. リスク分析

### 11.1 技術リスク
- **データ損失**: JSONファイルの破損・消失
  - 対策: 定期的なバックアップ、データ整合性チェック
- **パフォーマンス**: データ量増加による性能劣化
  - 対策: データベース化、インデックス最適化

### 11.2 運用リスク
- **可用性**: サーバー障害によるサービス停止
  - 対策: 監視システム、自動復旧機能
- **保守性**: 開発者の知識・経験不足
  - 対策: ドキュメント整備、コードレビュー

## 12. 承認・承認者

| 項目 | 承認者 | 承認日 | 備考 |
|------|--------|--------|------|
| 要件定義書 | プロジェクトマネージャー | 未定 | 初版作成 |
| システム設計書 | システム設計者 | 未定 | 次フェーズ |
| 実装完了 | プロジェクトマネージャー | 未定 | 最終承認 |

---

**文書作成日**: 2024年8月8日  
**作成者**: システム開発チーム  
**版数**: 1.0  
**承認**: 未承認
